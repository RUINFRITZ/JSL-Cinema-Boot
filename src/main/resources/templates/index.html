<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default_layout}">

<div layout:fragment="content">
    
    <div class="glass-panel" style="padding: 16px 50px; text-align: center; margin-bottom: 16px;">
        
        <p style="font-size: 0.9rem; color: var(--primary-color); font-weight: 700; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 10px;">
            JSL シネマ <span style ="color : gray">REMASTER</span>
        </p>

        <h1 style="font-size: 3.5rem; margin: 0 0 20px 0; line-height: 1.2; font-weight: 800; letter-spacing: -0.05em;">
            映画体験を、<span style="color: var(--primary-color);">再定義</span>する。
        </h1>
        
        <p style="color: #555; font-size: 1.1rem; margin-bottom: 10px; line-height: 1.8;">
        	あなただけの特等席で、最高の物語に出会う旅へ。<br>
            圧倒的な没入感と、スマートな予約システム。
        </p>
    </div>

	<div class="movie-scroll-container" id="movieScroll">
        
		<div class="movie-card-xl" th:each="movie : ${movieList}">
		    <a th:href="@{/movie/detail/{mno}(mno=${movie.mno})}" class="poster-link">
		        <img th:src="@{'/upload/' + ${movie.poster}}" alt="Movie Poster" class="movie-poster" onerror="this.src='/images/default_poster.jpg'">
		    </a>
		    
		    <div class="movie-info">
		        <h3 class="movie-title" th:title="${movie.title}" th:text="${movie.title}">映画タイトル</h3>
		        <p class="movie-catchphrase" th:text="${movie.catchphrase}">ここにキャッチフレーズが入ります。</p>
		        
		        <a th:href="@{/ticket/reserve(mno=${movie.mno})}" class="btn-reserve">予約する</a>
		    </div>
		</div>

        <div th:if="${movieList == null or movieList.isEmpty()}" style="width: 100%; text-align: center; padding: 50px; color: #888;">
            現在上映中の映画がありません。
        </div>

	</div>

	<script>
        document.addEventListener('DOMContentLoaded', function () {
            
			// -------------------------------------------------------
            // 1. ログイン成功トースト通知
            // -------------------------------------------------------
            const urlParams = new URLSearchParams(window.location.search);
            const isWelcome = urlParams.get('welcome');

            if (isWelcome) {
                const Toast = Swal.mixin({
                    toast: true,               
                    position: 'top-end',       
                    showConfirmButton: false,  
                    timer: 2222,               
                    timerProgressBar: true,    
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                });

                Toast.fire({
                    icon: 'success',
                    title: 'ようこそ！ログインしました。'
                });

                const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
                window.history.replaceState({path: newUrl}, '', newUrl);
            }
			
			// -------------------------------------------------------
	        // 2. マウスホイールによる横スクロール
	        // -------------------------------------------------------
	        const scrollContainer = document.getElementById("movieScroll");
	
	        if (scrollContainer) {
	            scrollContainer.addEventListener("wheel", (evt) => {
	                evt.preventDefault();
                    scrollContainer.scrollBy({
                        left: evt.deltaY * 4, 
                        behavior: 'smooth'    
                    });
	            });

                // -------------------------------------------------------
                // 3. 3.3秒間隔の自動スクロール
                // -------------------------------------------------------
                let autoScrollTimer;

                const startAutoScroll = () => {
                    autoScrollTimer = setInterval(() => {
                        // 現在のスクロール位置が終端に達しているか確認
                        const maxScrollLeft = scrollContainer.scrollWidth - scrollContainer.clientWidth;
                        
                        if (scrollContainer.scrollLeft >= maxScrollLeft - 10) {
                            // 終端に達した場合、最初（左端）に戻る
                            scrollContainer.scrollTo({ left: 0, behavior: 'smooth' });
                        } else {
                            // カード1枚分（幅 + gap分として約300px）を右へスクロール
                            // ※ 実際のカード幅を取得して動的に計算することも可能です
                            const cardWidth = scrollContainer.querySelector('.movie-card-xl')?.offsetWidth + 28 || 300;
                            scrollContainer.scrollBy({ left: cardWidth, behavior: 'smooth' });
                        }
                    }, 3333); 
                };

                // 初期状態で自動スクロールを開始
                startAutoScroll();

                // ユーザーがカードにマウスを乗せた時（UX向上）は自動スクロールを一時停止
                scrollContainer.addEventListener('mouseenter', () => clearInterval(autoScrollTimer));
                // マウスが離れたら再開
                scrollContainer.addEventListener('mouseleave', startAutoScroll);
	        }
        });
    </script>
</div>
</html>