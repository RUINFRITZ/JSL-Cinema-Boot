<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default_layout}">

<div layout:fragment="content">
    
    <style>
        /* [追加] 映画カード内のレイアウトおよびスタイル設定 */
        .movie-card-xl {
            min-width: 280px; /* カードの基本幅 */
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }
        
        .movie-card-xl:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .movie-poster {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-bottom: 1px solid #eee;
        }

        .movie-info {
            padding: 20px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .movie-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: #333;
            margin: 0 0 10px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .movie-catchphrase {
            font-size: 0.85rem;
            color: #666;
            margin: 0 0 20px 0;
            line-height: 1.4;
            height: 38px; /* 2行分の高さを確保 */
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .btn-reserve {
            margin-top: auto;
            display: block;
            text-align: center;
            background: var(--primary-color);
            color: #fff;
            padding: 12px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: background 0.3s;
        }

        .btn-reserve:hover {
            background: #cc5500;
            color: #fff;
        }
        
        /* スクロールコンテナのスタイル微調整 */
        .movie-scroll-container {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding-bottom: 20px;
            /* スクロールバーを隠す (Hide Scrollbar) */
            -ms-overflow-style: none;  
            scrollbar-width: none;  
        }
        .movie-scroll-container::-webkit-scrollbar {
            display: none;
        }
    </style>

    <div class="glass-panel" style="padding: 42px 50px; text-align: center; margin-bottom: 30px;">
        
        <p style="font-size: 0.9rem; color: var(--primary-color); font-weight: 700; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 10px;">
            JSL CINEMA <span style ="color : gray">REMASTER</span>
        </p>

        <h1 style="font-size: 3.5rem; margin: 0 0 20px 0; line-height: 1.2; font-weight: 800; letter-spacing: -0.05em;">
            映画体験を、<span style="color: var(--primary-color);">再定義</span>する。
        </h1>
        
        <p style="color: #555; font-size: 1.1rem; margin-bottom: 40px; line-height: 1.8;">
        	あなただけの特等席で、最高の物語に出会う旅へ。<br>
            圧倒的な没入感と、スマートな予約システム。
        </p>
    </div>

	<div class="movie-scroll-container" id="movieScroll">
        
        <div class="movie-card-xl" th:each="movie : ${movieList}">
            <img th:src="@{/images/movie/} + ${movie.poster}" alt="Movie Poster" class="movie-poster" onerror="this.src='/images/default_poster.jpg'">
            
            <div class="movie-info">
                <h3 class="movie-title" th:title="${movie.title}" th:text="${movie.title}">映画タイトル</h3>
                <p class="movie-catchphrase" th:text="${movie.catchphrase}">ここにキャッチフレーズが入ります。</p>
                
                <a th:href="@{/ticket/reserve(mno=${movie.mno})}" class="btn-reserve">予約する</a>
            </div>
        </div>

        <div th:if="${movieList == null or movieList.isEmpty()}" style="width: 100%; text-align: center; padding: 50px; color: #888;">
            現在上映中の映画がありません。
        </div>

	</div>

	<script>
        document.addEventListener('DOMContentLoaded', function () {
            
			// -------------------------------------------------------
            // 1. ログイン成功トースト通知 (Login Success Toast)
            // -------------------------------------------------------
            const urlParams = new URLSearchParams(window.location.search);
            const isWelcome = urlParams.get('welcome');

            if (isWelcome) {
                const Toast = Swal.mixin({
                    toast: true,               
                    position: 'top-end',       
                    showConfirmButton: false,  
                    timer: 2222,               
                    timerProgressBar: true,    
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                });

                Toast.fire({
                    icon: 'success',
                    title: 'ようこそ！ログインしました。'
                });

                const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
                window.history.replaceState({path: newUrl}, '', newUrl);
            }
			
			// -------------------------------------------------------
	        // 2. マウスホイールによる横スクロール (Horizontal Scroll)
	        // -------------------------------------------------------
	        const scrollContainer = document.getElementById("movieScroll");
	
	        if (scrollContainer) {
	            scrollContainer.addEventListener("wheel", (evt) => {
	                evt.preventDefault();
                    scrollContainer.scrollBy({
                        left: evt.deltaY * 4, 
                        behavior: 'smooth'    
                    });
	            });

                // -------------------------------------------------------
                // 3. 4秒間隔の自動スクロール (Auto Scroll Interval)
                // -------------------------------------------------------
                let autoScrollTimer;

                const startAutoScroll = () => {
                    // 4000ミリ秒（4秒）ごとに実行
                    autoScrollTimer = setInterval(() => {
                        // 現在のスクロール位置が終端に達しているか確認
                        const maxScrollLeft = scrollContainer.scrollWidth - scrollContainer.clientWidth;
                        
                        if (scrollContainer.scrollLeft >= maxScrollLeft - 10) {
                            // 終端に達した場合、最初（左端）に戻る
                            scrollContainer.scrollTo({ left: 0, behavior: 'smooth' });
                        } else {
                            // カード1枚分（幅 + gap分として約300px）を右へスクロール
                            // ※ 実際のカード幅を取得して動的に計算することも可能です
                            const cardWidth = scrollContainer.querySelector('.movie-card-xl')?.offsetWidth + 20 || 300;
                            scrollContainer.scrollBy({ left: cardWidth, behavior: 'smooth' });
                        }
                    }, 4000); 
                };

                // 初期状態で自動スクロールを開始
                startAutoScroll();

                // ユーザーがカードにマウスを乗せた時（UX向上）は自動スクロールを一時停止
                scrollContainer.addEventListener('mouseenter', () => clearInterval(autoScrollTimer));
                // マウスが離れたら再開
                scrollContainer.addEventListener('mouseleave', startAutoScroll);
	        }
        });
    </script>
</div>
</html>